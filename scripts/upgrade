#!/bin/bash

#=================================================
# GENERIC START
#=================================================
# IMPORT GENERIC HELPERS
#=================================================

source _common.sh
source /usr/share/yunohost/helpers

#=================================================
# MANAGE SCRIPT FAILURE
#=================================================

# Exit if an error occurs during the execution of the script
ynh_abort_if_errors

# TODO: handle "/home/ynh$app" to final_path migration

app=$YNH_APP_INSTANCE_NAME

# Source YunoHost helpers
source /usr/share/yunohost/helpers

# Retrieve app settings
# domain=$(ynh_app_setting_get "$app" domain)
# path=$(ynh_app_setting_get "$app" path)

# Build the app
# src_path=/home/yunohost.app/$app
# mkdir -p $src_path $src_path/node_modules
# git clone https://framagit.org/bnjbvr/kresus.git $src_path
# npm install --prefix $src_path $src_path
# .$src_path/scripts/build.sh

# Modify Nginx configuration file and copy it to Nginx conf directory
# nginx_conf=../conf/nginx.conf
# sed -i "s@YNH_WWW_PATH@$path@g" $nginx_conf
# cp $nginx_conf /etc/nginx/conf.d/$domain.d/$app.conf

# Setup service
# systemd_service=../conf/kresus.service
# sed -i "s@APP_TO_CHANGE@$app@g" $systemd_service
# cp $systemd_service /etc/systemd/system/$app.service
# systemctl enable $app
# systemctl start $app

# Reload nginx service
service nginx reload
